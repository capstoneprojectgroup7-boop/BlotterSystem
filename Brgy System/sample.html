<!DOCTYPE html>
<html>
<head>
  <title>Firebase Image Upload + Save URL</title>
</head>
<body>

<h2>Upload Image to Firebase & Save URL</h2>

<input type="file" id="imageInput"><br><br>
<button id="uploadBtn">Upload Image</button>

<p id="status"></p>

<script type="module">
  // ------------------ IMPORT FIREBASE MODULES ------------------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { 
    getStorage, ref as sRef, uploadBytesResumable, getDownloadURL 
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";
  import {
    getDatabase, ref, set
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  // ------------------ YOUR FIREBASE CONFIG ------------------
  const firebaseConfig = {
    apiKey: "AIzaSyCSUCbCVKEYZx_-dySDrAauf1OZ6GIUMgI",
    authDomain: "bpoms-15479.firebaseapp.com",
    databaseURL: "https://bpoms-15479-default-rtdb.firebaseio.com",
    projectId: "bpoms-15479",
    storageBucket: "gs://bpoms-15479.firebasestorage.app",
    messagingSenderId: "461076757426",
    appId: "1:461076757426:web:61adf7d3f1734cc05702ab"
  };
  // ------------------ INITIALIZE FIREBASE ------------------
  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);
  const db = getDatabase(app);

  // ------------------ UPLOAD FUNCTION ------------------
  document.getElementById("uploadBtn").addEventListener("click", () => {
    const file = document.getElementById("imageInput").files[0];

    if (!file) {
      alert("Please select an image.");
      return;
    }

    const storageRef = sRef(storage, "images/" + Date.now() + "_" + file.name);
    const uploadTask = uploadBytesResumable(storageRef, file);

    uploadTask.on(
      "state_changed",
      (snapshot) => {
        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        document.getElementById("status").innerText = "Uploading: " + progress.toFixed(0) + "%";
      },

      (error) => {
        alert("Upload failed: " + error.message);
      },

      () => {
        getDownloadURL(uploadTask.snapshot.ref).then((url) => {

          // SAVE URL TO REALTIME DATABASE
          const imageId = Date.now();
          set(ref(db, "images/" + imageId), {
            imageURL: url,
            fileName: file.name,
            uploadedAt: new Date().toISOString()
          });

          document.getElementById("status").innerText = "Upload complete!";
          alert("Image uploaded and URL saved successfully!");
          console.log("Image URL:", url);
        });
      }
    );
  });
</script>

</body>
</html>
